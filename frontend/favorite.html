<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="page_title_fav">YÃªu thÃ­ch</title>
    
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/accomodation_card.css">
    <link rel="stylesheet" href="css/routing.css">
    <link rel="stylesheet" href="css/favorite.css">
    <link rel="stylesheet" href="css/chatbot.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { background-color: #f9f9f9; }
        .fav-header { max-width: 1200px; margin: 80px auto 20px; padding: 0 20px; text-align: center; }
        .fav-header h2 { color: #333; margin-bottom: 10px; }
        .fav-header p { color: #666; }
    </style>
</head>
<body>

    <div id="navbar-root"></div>

    <div class="fav-header">
        <h2 data-i18n="fav_title">â¤ï¸ Danh sÃ¡ch Ä‘á»‹a Ä‘iá»ƒm yÃªu thÃ­ch</h2>
    </div>

    <div id="results-list" style="max-width: 1200px; margin: 0 auto; padding: 20px;"></div>

    <div id="routing-overlay" class="routing-overlay hidden">
        <div class="routing-modal">     
            <div id="view-step-1" class="view-container">
               <div class="col-left-info">
                   <div class="hotel-info-body">
                       <h2 id="info-name" class="hotel-title">...</h2>
                       <div class="favorite-row" style="display:none;"><span id="fav-toggle" class="fav-btn">â¤ï¸</span></div>
                       <div class="hotel-address-row"><span class="icon">ğŸ“</span> <span id="info-address">...</span></div>
                       <div class="hotel-price-row"><span class="label" data-i18n="label_price">GiÃ¡:</span><span id="info-price" class="price">...</span></div>
                       <div class="rating-badge">â­ <span id="info-rating">...</span></div>
                       <hr class="divider">
                       <div class="hotel-amenities-section"><h4 data-i18n="label_amenities">ğŸ’ Tiá»‡n Ã­ch</h4><div id="info-amenities" class="amenities"></div></div>
                   </div>
               </div>
               <div class="col-right-selection">
                   <h3 data-i18n="modal_step1_title">ğŸš™ Thiáº¿t láº­p lá»™ trÃ¬nh</h3>
                   <div class="form-group">
                       <label data-i18n="input_start_label">Äiá»ƒm xuáº¥t phÃ¡t:</label>
                       <input type="text" id="start-location" data-i18n="[placeholder]val_my_location" placeholder="Nháº­p vá»‹ trÃ­..." class="input-text">
                       <button id="btn-use-gps" class="btn-sm" style="margin-top:5px;" data-i18n="btn_use_gps">ğŸ“ DÃ¹ng vá»‹ trÃ­ hiá»‡n táº¡i</button>
                   </div>
                   <div class="form-group">
                       <label data-i18n="input_dest_label">Äiá»ƒm Ä‘áº¿n:</label>
                       <input type="text" id="target-dest" value="..." disabled class="input-readonly">
                   </div>
                   <div class="form-group">
                       <label data-i18n="input_transport_label">PhÆ°Æ¡ng tiá»‡n:</label>
                       <div class="transport-options">
                           <label class="radio-card"><input type="radio" name="transport" value="driving" checked><span data-i18n="trans_driving">ğŸš— Ã” tÃ´</span></label>
                           <label class="radio-card"><input type="radio" name="transport" value="cycling"><span data-i18n="trans_cycling">ğŸš² Xe Ä‘áº¡p</span></label>
                           <label class="radio-card"><input type="radio" name="transport" value="foot"><span data-i18n="trans_walking">ğŸš¶ Äi bá»™</span></label>
                       </div>
                   </div>
                   <div class="action-buttons">
                       <button id="btn-close-step1" class="btn-secondary" data-i18n="btn_close">ÄÃ³ng</button>
                       <button id="btn-find-route" class="btn-primary" data-i18n="btn_find_route">ğŸ—ºï¸ TÃ¬m Ä‘Æ°á»ng Ä‘i</button>
                   </div>
               </div>
            </div>

            <div id="view-step-2" class="view-container hidden">
                <div class="col-left-analysis">
                    <button id="btn-back-step1" class="btn-back">â¬… <span data-i18n="btn_back">Quay láº¡i</span></button>
                    <div class="analysis-box">
                        <h4 data-i18n="analysis_title">ğŸ“Š Káº¿t quáº£</h4>
                        <div class="stats-grid"><div class="stat">ğŸ“ <span id="res-distance">...</span></div><div class="stat">â± <span id="res-duration">...</span></div></div>
                        <div class="complexity-box"><strong id="res-label">...</strong><p id="res-summary">...</p><ul id="res-details"></ul></div>
                        <div class="advice-box">ğŸ’¡ <span id="res-advice">...</span></div>
                    </div>
                    <div class="steps-box"><h4 data-i18n="steps_title">ğŸ“ HÆ°á»›ng dáº«n</h4><div id="steps-list" class="steps-scroll"></div></div>
                </div>
                <div class="col-right-map">
                    <div id="rt-map" style="width: 100%; height: 100%; min-height: 400px;"></div>
                    <div class="map-controls-overlay">
                        <select id="quick-transport-change">
                            <option value="driving" data-i18n="trans_driving">ğŸš— Ã” tÃ´</option>
                            <option value="cycling" data-i18n="trans_cycling">ğŸš² Xe Ä‘áº¡p</option>
                            <option value="foot" data-i18n="trans_walking">ğŸš¶ Äi bá»™</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. Logic xá»­ lÃ½ user Ä‘Äƒng nháº­p
        function logoutUser() {
            localStorage.removeItem('loggedInUserEmail');
            location.reload(); 
        }

        function formatEmail(email) {
            if (!email) return "NgÆ°á»i dÃ¹ng";
            return email.split('@')[0]; 
        }

        function updateNavbarForLoggedInUser() {
            const userEmail = localStorage.getItem('loggedInUserEmail'); 
            const navbarRoot = document.getElementById('navbar-root');
            
            // Chá»‰ cháº¡y khi navbar Ä‘Ã£ cÃ³ ná»™i dung
            if (navbarRoot && navbarRoot.innerHTML.trim() !== "") {
                const loginButtonContainer = navbarRoot.querySelector('.nav-right'); 
                if (userEmail && loginButtonContainer) {
                    const displayName = formatEmail(userEmail);
                    loginButtonContainer.innerHTML = `
                        <div class="user-info-group" style="display:flex; align-items:center; gap:10px;">
                            <span class="user-greeting" style="color:white;">ğŸ‘‹ ${displayName}</span>
                            <button class="btn-logout" onclick="logoutUser()" style="padding:5px 10px; cursor:pointer;">
                                <span>ÄÄƒng xuáº¥t</span>
                            </button>
                        </div>
                    `;
                }
            }
        }

        // 2. Cháº¡y khi trang load xong
        document.addEventListener('DOMContentLoaded', () => {
            
            // Load Navbar tá»« components/navbar.html (ÄÆ°á»ng dáº«n Ä‘Ãºng)
            fetch('components/navbar.html')
                .then(response => {
                    if (!response.ok) throw new Error("Lá»—i táº£i Navbar: " + response.status);
                    return response.text();
                })
                .then(html => { 
                    // Kiá»ƒm tra xem server cÃ³ tráº£ vá» lá»—i 404 text khÃ´ng
                    if (html.includes("Cannot GET") || html.startsWith("<!DOCTYPE")) {
                        console.error("Ná»™i dung Navbar khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng HTML");
                        return;
                    }

                    document.getElementById('navbar-root').innerHTML = html; 
                    
                    // Cáº­p nháº­t giao diá»‡n ngÆ°á»i dÃ¹ng
                    updateNavbarForLoggedInUser();

                    // KÃ­ch hoáº¡t dá»‹ch thuáº­t sau khi Navbar Ä‘Ã£ chÃ¨n vÃ o DOM
                    const currentLang = localStorage.getItem('lang') || 'vi';
                    // Kiá»ƒm tra hÃ m loadLanguage tá»« file static_trans.js
                    if (typeof loadLanguage === 'function') {
                        loadLanguage(currentLang);
                    } else if (typeof loadAndApplyLanguage === 'function') {
                        loadAndApplyLanguage(currentLang);
                    }
                })
                .catch(e => console.error('Lá»—i script navbar:', e));
        });
    </script>

    <script src="js/static_trans.js" ></script>
    <script src="js/display_result_rec.js"></script> 
    <script src="js/routing_rec_page.js"></script> 
</body>
</html>