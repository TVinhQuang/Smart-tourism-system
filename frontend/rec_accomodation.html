<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gá»£i Ã½ NÆ¡i á»</title>

    <link rel="stylesheet" href="css/rec_accomodation.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/routing.css">
    <link rel="stylesheet" href="css/chatbot.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

</head>

<body>
    <div id="navbar-root"></div>

    <h1 class="page-title" data-i18n="page_title_rec">ğŸ¨ Gá»£i Ã NÆ¡i á» PhÃ¹ Há»£p</h1>
    <h2 class="page-subtitle" data-i18n="page_subtitle_rec">Äiá»n thÃ´ng tin dÆ°á»›i Ä‘Ã¢y Ä‘á»ƒ nháº­n gá»£i Ã½ nÆ¡i lÆ°u trÃº tá»‘t nháº¥t cho chuyáº¿n Ä‘i cá»§a báº¡n!</h2>
    
    <div class="form-section">

        <div class="form-group">
            <label data-i18n="label_city">ThÃ nh phá»‘ Äiá»ƒm Ä‘áº¿n</label>
            <input type="text" id="city" value="Há»“ ChÃ­ Minh" placeholder="Nháº­p tÃªn thÃ nh phá»‘...">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label data-i18n="label_price_from1">GiÃ¡ tá»« (VND)</label>
                <input type="number" id="price-min" value="300000" step="50000">
            </div>

            <div class="form-group">
                <label data-i18n="label_price_to1">GiÃ¡ Ä‘áº¿n (VND)</label>
                <input type="number" id="price-max" value="1500000" step="50000">
            </div>
        </div>

        <div class="form-group">
            <label data-i18n="label_type">Loáº¡i hÃ¬nh</label>
            <div class="checkbox-group">
                <label><input type="checkbox" class="type-checkbox" value="hotel" checked> Hotel</label>
                <label><input type="checkbox" class="type-checkbox" value="homestay" checked> Homestay</label>
                <label><input type="checkbox" class="type-checkbox" value="hostel"> Hostel</label>
                <label><input type="checkbox" class="type-checkbox" value="apartment"> Apartment</label>
                <label><input type="checkbox" class="type-checkbox" value="resort"> Resort</label>
            </div>
        </div>

        <div class="form-group">
            <label data-i18n="label_search_params">Bá»™ lá»c nÃ¢ng cao</label>
            
            <div class="filter-row" style="margin-top: 15px;">
    
    <div class="filter-item">
        <label data-i18n="label_min_rating">ÄÃ¡nh giÃ¡ tá»‘i thiá»ƒu</label>
        <div class="checkbox-group-vertical">
            <label>
                <input type="radio" name="min_rating" value="3" checked> 
                Tá»« 3 sao trá»Ÿ lÃªn
            </label>
            <label>
                <input type="radio" name="min_rating" value="4"> 
                Tá»« 4 sao trá»Ÿ lÃªn
            </label>
            <label>
                <input type="radio" name="min_rating" value="5"> 
                5 sao
            </label>
        </div>
    </div>

        <div class="filter-item">
            <label data-i18n="label_radius">Khoáº£ng cÃ¡ch tá»« trung tÃ¢m</label>
            <div class="checkbox-group-vertical">
                <label>
                    <input type="radio" name="radius" value="1"> 
                    DÆ°á»›i 1 km
                </label>
                <label>
                    <input type="radio" name="radius" value="3"> 
                    DÆ°á»›i 3 km
                </label>
                <label>
                    <input type="radio" name="radius" value="5" checked> 
                    DÆ°á»›i 5 km
                </label>
            </div>
        </div>
    </div>

        <div class="form-group">
            <label data-i18n="label_amenity_pref">Tiá»‡n Ã­ch Æ¯U TIÃŠN</label>
            <div class="checkbox-group">
                <label><input type="checkbox" class="amenity-preferred" value="wifi"> WiFi</label>
                <label><input type="checkbox" class="amenity-preferred" value="breakfast" checked> Breakfast</label>
                <label><input type="checkbox" class="amenity-preferred" value="pool"> Pool</label>
                <label><input type="checkbox" class="amenity-preferred" value="parking"> Parking</label>
                <label><input type="checkbox" class="amenity-preferred" value="gym"> Gym</label>
                <label><input type="checkbox" class="amenity-preferred" value="spa"> Spa</label>
                <label><input type="checkbox" class="amenity-preferred" value="airport_shuttle"> Airport Shuttle</label>
            </div>
        </div>

        <div class="form-group">
            <label for="priority" data-i18n="label_priority">Chiáº¿n lÆ°á»£c xáº¿p háº¡ng</label>
            <select id="priority">
                <option value="balanced" data-i18n="opt_balanced">CÃ¢n báº±ng (KhuyÃªn dÃ¹ng)</option>
                <option value="cheap" data-i18n="opt_cheap">Æ¯u tiÃªn giÃ¡ ráº»</option>
                <option value="near_center" data-i18n="opt_center">Æ¯u tiÃªn gáº§n trung tÃ¢m</option>
                <option value="amenities" data-i18n="opt_amenities">Æ¯u tiÃªn tiá»‡n Ã­ch</option>
            </select>
        </div>

        <button type="button" class="submit-btn" onclick="submitSearch()" data-i18n="btn_search_rec">ğŸ” Gá»£i Ã½ Top 5 nÆ¡i á»Ÿ</button>

        <div id="results-container">
            <h2 data-i18n="header_results">Káº¿t quáº£</h2>
            <div id="relaxation-note" style="display:none; background:#fff3cd; color:#856404; padding:10px; border-radius:5px; margin-bottom:15px; border:1px solid #ffeeba;"></div>
            <div id="results-list"></div>
        </div>
    </div>

    <div id="routing-overlay" class="routing-overlay hidden">
       <div class="routing-modal">     
            <div id="view-step-1" class="view-container">
                <div class="col-left-info">
                    <div class="hotel-cover">
                        <div class="rating-badge">â­ <span id="info-rating">...</span></div>
                    </div>
                    <div class="hotel-info-body">
                        <h2 id="info-name" class="hotel-title">TÃªn khÃ¡ch sáº¡n</h2>
                        <div class="favorite-row"><span id="fav-toggle" class="fav-btn">â™¡</span></div>
                        <div class="hotel-address-row"><span class="icon">ğŸ“</span> <span id="info-address">...</span></div>
                        <div class="hotel-price-row"><span class="label">GiÃ¡ má»—i Ä‘Ãªm:</span><span id="info-price" class="price">...</span></div>
                        <hr class="divider">
                        <div class="hotel-amenities-section"><h4>ğŸ’ Tiá»‡n Ã­ch</h4><div id="info-amenities" class="amenities"></div></div>
                    </div>
                </div>
                <div class="col-right-selection">
                    <h3>ğŸš™ Thiáº¿t láº­p lá»™ trÃ¬nh</h3>
                    <div class="form-group"><label>Äiá»ƒm xuáº¥t phÃ¡t:</label><div style="display:flex;gap:5px;"><input type="text" id="start-location" class="input-editable" style="flex:1;"><button id="btn-use-gps">ğŸ“</button></div></div>
                    <div class="form-group"><label>Äiá»ƒm Ä‘áº¿n:</label><input type="text" id="target-dest" disabled class="input-readonly"></div>
                    <div class="form-group"><label>PhÆ°Æ¡ng tiá»‡n:</label><div class="transport-options">
                        <label class="radio-card"><input type="radio" name="transport" value="driving" checked><span>ğŸš— Ã” tÃ´</span></label>
                        <label class="radio-card"><input type="radio" name="transport" value="cycling"><span>ğŸš² Xe Ä‘áº¡p</span></label>
                        <label class="radio-card"><input type="radio" name="transport" value="walking"><span>ğŸš¶ Äi bá»™</span></label>
                    </div></div>
                    <div class="action-buttons"><button id="btn-close-step1" class="btn-secondary">ÄÃ³ng</button><button id="btn-find-route" class="btn-primary">ğŸ—ºï¸ TÃ¬m Ä‘Æ°á»ng Ä‘i</button></div>
                </div>
            </div>
            <div id="view-step-2" class="view-container hidden" style="height: 80vh;">
                <div class="col-left-analysis" style="overflow-y: auto; height: 100%;">
                    <button id="btn-back-step1" class="btn-back">â¬… Quay láº¡i</button>
                    <div class="analysis-box">
                        <h4>ğŸ“Š Káº¿t quáº£ phÃ¢n tÃ­ch</h4>
                        <div class="stats-grid"><div class="stat">Khoáº£ng cÃ¡ch: <span id="res-distance">...</span></div><div class="stat">Thá»i gian: <span id="res-duration">...</span></div></div>
                        <div class="complexity-box">
                            <strong id="res-label">...</strong>
                            <p id="res-summary">...</p>
                            
                            <p id="res-advice" style="font-style: italic; color: #555; font-size: 0.9rem; margin-top: 5px;">...</p>
                            
                            <ul id="res-details"></ul>
                        </div>
                    </div>
                    <div class="steps-box"><h4>ğŸ“ HÆ°á»›ng dáº«n</h4><div id="steps-list" class="steps-scroll"></div></div>
                </div> 
                <div class="col-right-map" style="position: relative; height: 100%;"><div id="rt-map" style="width: 100%; height: 100%;"></div></div>
            </div>
        </div>
    </div>

    <script>
    function logoutUser() {
        localStorage.removeItem('loggedInUserEmail');
        window.location.href = location.reload(); // Hoáº·c reload láº¡i trang
    }

    function formatEmail(email) {
        if (!email) return "NgÆ°á»i dÃ¹ng";
        const parts = email.split('@');
        return parts[0]; 
    }

    function updateNavbarForLoggedInUser() {
        const userEmail = localStorage.getItem('loggedInUserEmail'); 
        const navbarRoot = document.getElementById('navbar-root');
        
        // Äáº£m báº£o navbar Ä‘Ã£ Ä‘Æ°á»£c load xong má»›i thao tÃ¡c
        if (navbarRoot.innerHTML.trim() !== "") {
            const loginButtonContainer = navbarRoot.querySelector('.nav-right'); 

            if (userEmail) {
                const displayName = formatEmail(userEmail);
                if (loginButtonContainer) {
                    loginButtonContainer.innerHTML = `
                        <div class="user-info-group">
                            <span class="user-greeting">ğŸ‘‹ Xin chÃ o, <strong>${displayName}</strong></span>
                            <button class="btn-logout" onclick="logoutUser()">
                                <img src="images/logout.png" class="logout-icon" style="height: 16px;">
                                <span>ÄÄƒng xuáº¥t</span>
                            </button>
                        </div>
                    `;
                }
            } else {
                // Náº¿u chÆ°a Ä‘Äƒng nháº­p, Ä‘áº£m báº£o hiá»‡n nÃºt Login
                if (loginButtonContainer) {
                    loginButtonContainer.innerHTML = `
                        <a href="login.html" class="btn-login">
                            <img src="images/login.png" class="login-icon">
                            <span>ÄÄƒng nháº­p</span>
                        </a>
                    `;
                }
            }
        }
    }

    // 2. Logic cháº¡y khi táº£i trang
    document.addEventListener('DOMContentLoaded', () => {
        fetch('components/navbar.html')
            .then(r => r.text())
            .then(html => { 
                document.getElementById('navbar-root').innerHTML = html; 
                
                // 1. Cáº­p nháº­t user Ä‘Äƒng nháº­p
                updateNavbarForLoggedInUser();

                // --- 2. THÃŠM ÄOáº N NÃ€Y Äá»‚ KÃCH HOáº T Dá»ŠCH (FIX Lá»–I) ---
                // Láº¥y ngÃ´n ngá»¯ tá»« localStorage hoáº·c máº·c Ä‘á»‹nh lÃ  'vi'
                const currentLang = localStorage.getItem('lang') || 'vi';
                
                // Kiá»ƒm tra náº¿u hÃ m loadAndApplyLanguage (tá»« file static_trans.js) Ä‘Ã£ sáºµn sÃ ng
                if (typeof loadAndApplyLanguage === 'function') {
                    loadAndApplyLanguage(currentLang).then(() => {
                         // Náº¿u cáº§n lÃ m gÃ¬ sau khi dá»‹ch xong thÃ¬ viáº¿t á»Ÿ Ä‘Ã¢y
                         console.log("ÄÃ£ dá»‹ch sang: " + currentLang);
                    });
                } else {
                    console.warn("ChÆ°a tÃ¬m tháº¥y hÃ m loadAndApplyLanguage. Kiá»ƒm tra láº¡i file static_trans.js");
                }
                // -----------------------------------------------------
            })
            .catch(e => console.warn('KhÃ´ng thá»ƒ load navbar component', e));
    });
    </script>
    
    <script src="js/navbar_loader.js"></script>
    <script src="js/chatbot.js"></script>
    <script src="js/static_trans.js"></script>
    <script src="js/display_result_rec.js"></script> 
    <script src="js/routing_rec_page.js"></script>
    <script src="js/submit_search.js"></script>
</body>
</html>