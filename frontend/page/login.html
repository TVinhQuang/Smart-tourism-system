<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="app_title">Login/Register</title>

    <link rel="stylesheet" href="../css/login.css">
</head>
<body>
    
    <div class="language-selector">
        <div class="dropdown">
            <a href="#" class="dropdown-btn" onclick="toggleLanguageMenu(); return false;"> 
                <img src="../../images/translation.png" class="icon" alt="Language Icon"> 
                <span data-i18n="nav_language">D·ªãch</span>
                <span> üîΩ</span>
            </a>

            <ul class="dropdown-menu hidden" id="languageMenu"> 
                <li><a href="#" onclick="changeLanguage('en')" data-i18n="nav_lang_en">English</a></li>
                <li><a href="#" onclick="changeLanguage('vi')" data-i18n="nav_lang_vi">Ti·∫øng Vi·ªát</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        
        <div class="form-box" id="loginBox">
            <h2 data-i18n="login_title">ƒêƒÉng Nh·∫≠p</h2>
            <form onsubmit="return loginUser()">
                <div class="input-group">
                    <input type="email" required>
                    <label data-i18n="login_email">Email</label>
                </div>

                <div class="input-group">
                    <input type="password" required>
                    <label data-i18n="login_password">M·∫≠t kh·∫©u</label>
                </div>

                <button type="submit" class="btn" data-i18n="btn_login_submit">ƒêƒÉng nh·∫≠p</button>
                
                <a href="homepage.html" class="btn btn-back" data-i18n="btn_back_home">‚¨Ö Quay l·∫°i Trang ch·ªß</a> 

                <p class="switch">
                    <span data-i18n="login_no_account">Ch∆∞a c√≥ t√†i kho·∫£n?</span> 
                    <span onclick="showRegister()" data-i18n="login_register_link">ƒêƒÉng k√Ω</span>
                </p>
            </form> 
        </div>

        <div class="form-box hidden" id="registerBox">
            <h2 data-i18n="register_title">ƒêƒÉng K√Ω</h2>
            <form>
                <div class="input-group">
                    <input type="text" required>
                    <label data-i18n="register_username">T√™n t√†i kho·∫£n</label>
                </div>

                <div class="input-group">
                    <input type="email" required>
                    <label data-i18n="login_email">Email</label>
                </div>

                <div class="input-group">
                    <input type="password" required>
                    <label data-i18n="login_password">M·∫≠t kh·∫©u</label>
                </div>

                <button type="submit" class="btn" data-i18n="btn_register_submit">T·∫°o t√†i kho·∫£n</button>

                <p class="switch">
                    <span data-i18n="register_has_account">ƒê√£ c√≥ t√†i kho·∫£n?</span> 
                    <span onclick="showLogin()" data-i18n="btn_login_submit">ƒêƒÉng nh·∫≠p</span>
                </p>
            </form>
        </div>
    </div>
    
    <script>
    // --- KH·ªêI D√ôNG CHUNG: D·ªäCH THU·∫¨T V√Ä TOGGLE DROPWDOWN ---

    let currentTranslations = {};

    function getTranslation(key) {
        return currentTranslations[key] || key;
    }

    function applyTranslations() {
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = getTranslation(key);
            
            if (element.tagName === 'BUTTON' || element.tagName === 'A') {
                if (element.lastChild && element.lastChild.nodeType === 3) {
                    element.lastChild.textContent = translation;
                } else {
                    element.textContent = translation;
                }
            } else {
                element.textContent = translation;
            }
        });
        document.querySelectorAll('label[data-i18n]').forEach(element => {
             const key = element.getAttribute('data-i18n');
             element.textContent = getTranslation(key);
        });
    }

    async function loadAndApplyLanguage(lang) {
        const filePath = `../i18n/${lang}.json`;
        
        try {
            const response = await fetch(filePath);
            if (!response.ok) { throw new Error(`Kh√¥ng th·ªÉ t·∫£i file d·ªãch thu·∫≠t: ${filePath}`); }
            currentTranslations = await response.json();
            localStorage.setItem('lang', lang); 

            applyTranslations();
            
        } catch (error) {
            console.error(error);
            alert(getTranslation('alert_language_load_error') || `L·ªói: Kh√¥ng th·ªÉ t·∫£i ng√¥n ng·ªØ (${lang}). Vui l√≤ng ki·ªÉm tra ƒë∆∞·ªùng d·∫´n JSON.`);
        }
    }

    function changeLanguage(lang) {
        loadAndApplyLanguage(lang);
        
        // ƒê√≥ng menu sau khi ch·ªçn ng√¥n ng·ªØ
        document.getElementById('languageMenu').classList.add('hidden');
        document.removeEventListener('click', closeMenuOutside);
        
        return false;
    }

    function toggleLanguageMenu() {
        const menu = document.getElementById('languageMenu');
        menu.classList.toggle('hidden'); 

        if (!menu.classList.contains('hidden')) {
            document.addEventListener('click', closeMenuOutside);
        } else {
            document.removeEventListener('click', closeMenuOutside);
        }
    }

    function closeMenuOutside(event) {
        const dropdown = document.querySelector('.dropdown');
        const menu = document.getElementById('languageMenu');

        if (dropdown && !dropdown.contains(event.target)) {
            menu.classList.add('hidden');
            document.removeEventListener('click', closeMenuOutside);
        }
    }
    
    // --- LOGIC RI√äNG C·ª¶A TRANG LOGIN/REGISTER ---

    function showRegister() {
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("registerBox").classList.remove("hidden");
        applyTranslations(); // √Åp d·ª•ng l·∫°i d·ªãch thu·∫≠t cho form m·ªõi hi·ªán ra
    }

    function showLogin() {
        document.getElementById("registerBox").classList.add("hidden");
        document.getElementById("loginBox").classList.remove("hidden");
        applyTranslations(); // √Åp d·ª•ng l·∫°i d·ªãch thu·∫≠t cho form m·ªõi hi·ªán ra
    }

    // ‚≠ê H√ÄM QUAN TR·ªåNG: S·ª¨A L·ªñI M·∫§T ƒêƒÇNG NH·∫¨P B·∫∞NG LOCALSTORAGE
    function loginUser() {
        const email = document.querySelector("#loginBox input[type='email']").value;
        const pass = document.querySelector("#loginBox input[type='password']").value;

        if (email === "" || pass === "") {
            alert(getTranslation('alert_empty_fields')); 
            return false;
        }

        // L∆ØU TR·∫†NG TH√ÅI ƒêƒÇNG NH·∫¨P V√ÄO LOCAL STORAGE
        localStorage.setItem('loggedInUserEmail', email);

        // Chuy·ªÉn h∆∞·ªõng kh√¥ng c·∫ßn tham s·ªë URL
        window.location.href = `homepage.html`; 
        return false;
    }

    // --- KH·ªûI T·∫†O TRANG ---
    document.addEventListener('DOMContentLoaded', () => {
        // T·∫£i ng√¥n ng·ªØ ƒë√£ l∆∞u ho·∫∑c m·∫∑c ƒë·ªãnh l√† Ti·∫øng Vi·ªát
        const defaultLang = localStorage.getItem('lang') || 'vi'; 
        loadAndApplyLanguage(defaultLang);
    });
    </script>

</body>
</html>