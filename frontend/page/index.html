import streamlit as st
import streamlit.components.v1 as components

st.set_page_config(
    page_title="Du lá»‹ch Viá»‡t Nam",
    page_icon="ğŸŒ",
    layout="wide"
)

# Initialize session state for current page
if "current_html_page" not in st.session_state:
    st.session_state.current_html_page = "homepage"

# Xá»¬ LÃ NAVIGATION TRÆ¯á»šC KHI RENDER
# Check query params Ä‘á»ƒ chuyá»ƒn trang
nav_param = st.query_params.get("navigate")
if nav_param == "recommend":
    if st.session_state.current_html_page != "recommend":
        st.session_state.current_html_page = "recommend"
        st.query_params.clear()
        st.rerun()
elif nav_param == "home":
    if st.session_state.current_html_page != "homepage":
        st.session_state.current_html_page = "homepage"
        st.query_params.clear()
        st.rerun()

# Äá»c file HTML dá»±a trÃªn trang hiá»‡n táº¡i
if st.session_state.current_html_page == "recommend":
    html_file = "page/recommendpage.html"
    height = 1500
else:
    html_file = "page/homepage.html"
    height = 1200

with open(html_file, "r", encoding="utf-8") as f:
    html_content = f.read()

# Render HTML component vá»›i key Ä‘á»ƒ force re-render khi Ä‘á»•i trang
components.html(html_content, height=height, scrolling=True, key=st.session_state.current_html_page)

# JavaScript Ä‘á»ƒ handle navigation messages tá»« iframe
# Äáº·t á»Ÿ cuá»‘i Ä‘á»ƒ Ä‘áº£m báº£o DOM Ä‘Ã£ sáºµn sÃ ng
st.markdown("""
<script>
    // Listen for messages from iframe (components.html)
    window.addEventListener("message", function(event) {
        console.log("Received message:", event.data);
        // Kiá»ƒm tra origin Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n (cÃ³ thá»ƒ bá» qua khi dev local)
        if (event.data && event.data.type === "navigate") {
            const page = event.data.page;
            console.log("Navigating to:", page);
            // Sá»­ dá»¥ng window.location Ä‘á»ƒ redirect vá»›i query param
            const url = new URL(window.location.href);
            url.searchParams.set('navigate', page);
            // Force reload vá»›i query param má»›i
            window.location.href = url.toString();
        }
    }, false);
    
    // Debug: Log khi script Ä‘Æ°á»£c load
    console.log("Navigation listener script loaded");
</script>
""", unsafe_allow_html=True)

